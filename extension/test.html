<!DOCTYPE html>
<head>
  <title>Create Account</title>
  <style>
    body{font-family:Arial;background:#f0f9ff;text-align:center;padding:80px;}
    .box{max-width:460px;margin:auto;background:white;padding:40px;border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,0.15);}
    input{width:100%;padding:16px;margin:12px 0;border:1px solid #ddd;border-radius:12px;font-size:16px;box-sizing:border-box;}
    .pass-wrapper{position:relative;display:inline-block;width:100%;}
    .pass-wrapper input{padding-right:55px;}
    .eye{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:22px;opacity:0.7;}
    button{padding:16px 28px;background:#10b981;color:white;border:none;border-radius:12px;font-size:16px;cursor:pointer;margin:8px;}
    .gen{background:#6366f1;}
    .strength{margin:15px 0;font-weight:bold;font-size:17px;}
  </style>
</head>
<body>
<div class="box">
  <h2>Create Account</h2>
  <form id="regForm">
    <input type="email" id="email" value="test@demo.com" placeholder="Email" required><br>
    
    <div class="pass-wrapper">
      <input type="password" id="pass" value="MyPass123!" placeholder="Password" required>
      <span class="eye" onclick="let p=document.getElementById('pass');p.type=p.type==='password'?'text':'password';">Eye</span>
    </div>

    <button type="button" class="gen" onclick="generatePassword()">Generate Password</button>
    
    <div class="strength" id="strength" style="color:#10b981">Strength: Strong</div>
    
    <button type="submit" style="width:100%;padding:18px;font-size:18px;background:#10b981">Register</button>
  </form>
</div>

<script>
function generatePassword() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
  let pass = "";
  for(let i = 0; i < 16; i++) pass += chars.charAt(Math.floor(Math.random() * chars.length));
  document.getElementById("pass").value = pass;
  updateStrength();
}

function updateStrength() {
  const p = document.getElementById("pass").value;
  let score = 0;
  if (p.length >= 12) score += 2;
  else if (p.length >= 8) score += 1;
  if (/[a-z]/.test(p)) score++;
  if (/[A-Z]/.test(p)) score++;
  if (/[0-9]/.test(p)) score++;
  if (/[^A-Za-z0-9]/.test(p)) score++;

  let text = "", color = "";
  if (score >= 6) { text = "Strong"; color = "#10b981"; }
  else if (score >= 4) { text = "Medium"; color = "#f59e0b"; }
  else { text = "Weak"; color = "#ef4444"; }

  document.getElementById("strength").textContent = "Strength: " + text;
  document.getElementById("strength").style.color = color;
}

document.getElementById("pass").addEventListener("input", updateStrength);
updateStrength();

// Handle registration submit: save credentials via extension (if available) then go to login page
document.getElementById("regForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  const pwd = document.getElementById("pass").value;

  if (!email || !pwd) {
    alert("Please fill in both email and password.");
    return;
  }

  // Try to send to background script so it can encrypt + store
  if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
    chrome.runtime.sendMessage(
      {
        type: "SAVE_FROM_PAGE",
        payload: {
          site: location.host || "localhost",
          email: email,
          password: pwd,
        },
      },
      function () {
        // After saving (or even if it fails silently), go to login screen
        window.location.href = "test-login.html";
      }
    );
  } else {
    // Fallback: just go to login page
    window.location.href = "test-login.html";
  }
});
</script>
</body>
</html>